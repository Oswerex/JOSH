<!DOCTYPE html>
<html lang="fil">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Safety Training with Assessment</title>

<style>
    :root {
        --primary:#0b5fff;
        --danger:#cc0033;
        --success:#1a7f37;
        --muted:#666;
        --card-bg:#ffffffcc;
        --bg:#e9efff;
    }
    body {
        background: linear-gradient(135deg,#0b5fff33,#ffffff);
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        line-height: 1.5;
    }
    .container { max-width: 900px; margin: auto; }
    .card {
        background: var(--card-bg);
        backdrop-filter: blur(6px);
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 3px 12px rgba(0,0,0,0.12);
        margin-top: 20px;
    }
    .hidden { display:none; }
    .btn { padding: 10px 16px; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
    .btn-primary { background: var(--primary); color:#fff; }
    .btn-muted { background:#e5e5e5; color:#333; }

    input[type="text"] {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
        width: 250px;
    }

    .video-container {
        position: relative; width:100%; padding-top:56.25%;
    }
    .video-container video {
        position:absolute; top:0; left:0; width:100%; height:100%; border-radius:10px;
    }

    .question { font-weight: 600; margin-bottom: 6px; }
    .question-block { margin-bottom: 18px; }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div class="container">

<h2>Safety Training Module</h2>

<!-- VIDEO -->
<div class="card video-card">
    <h3>Watch the Safety Orientation Video</h3>
    <div class="video-container">
        <video id="trainingVideo" controls>
            <source src="https://oxwcrrgwbblxfozvqbmm.supabase.co/storage/v1/object/public/training%20videos/safety%20video.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
    <div style="margin-top:12px;">
        <label>
            <input type="checkbox" id="watchedChk" disabled> I confirm that I watched the video.
        </label>
    </div>
</div>

<div class="card">
    <button id="startBtn" class="btn btn-primary" disabled>Start Assessment</button>
    <button id="resetBtn" class="btn btn-muted hidden">Reset</button>
</div>

<!-- ASSESSMENT -->
<div id="assessment" class="card hidden">
    <h3>Assessment</h3>

    <!-- 10 QUESTIONS -->
    <div class="question-block">
        <label class="question">1. What type of facility is Meralco Operating Center?</label><br>
        <label><input type="radio" name="q1" value="Smoke-free"> Smoke-free</label><br>
        <label><input type="radio" name="q1" value="Pet Friendly"> Pet Friendly</label><br>
        <label><input type="radio" name="q1" value="Smoke-free and Pet Friendly"> Smoke-free and Pet Friendly</label><br>
        <label><input type="radio" name="q1" value="None"> None of the above</label>
    </div>

    <div class="question-block">
        <label class="question">2. What is the maximum speed limit in Meralco Operating Center?</label><br>
        <label><input type="radio" name="q2" value="20KPH"> 20 KPH</label><br>
        <label><input type="radio" name="q2" value="30KPH"> 30 KPH</label><br>
        <label><input type="radio" name="q2" value="40KPH"> 40 KPH</label><br>
        <label><input type="radio" name="q2" value="50KPH"> 50 KPH</label>
    </div>

    <div class="question-block">
        <label class="question">3. Which procedure should be followed when using a fire extinguisher?</label><br>
        <label><input type="radio" name="q3" value="PASS"> P.A.S.S.</label><br>
        <label><input type="radio" name="q3" value="TAB"> T.A.B.</label><br>
        <label><input type="radio" name="q3" value="SOP"> S.O.P.</label><br>
        <label><input type="radio" name="q3" value="None"> None of the above</label>
    </div>

    <div class="question-block">
        <label class="question">4. Which fire suppression systems are installed in the Meralco Operating Center?</label><br>
        <label><input type="radio" name="q4" value="A"> Fire Sprinkler</label><br>
        <label><input type="radio" name="q4" value="B"> Heat and Smoke Detectors</label><br>
        <label><input type="radio" name="q4" value="C"> Fire Alarm Horns</label><br>
        <label><input type="radio" name="q4" value="All of the above"> All of the above</label>
    </div>

    <div class="question-block">
        <label class="question">5. Unless there is a scheduled drill today, when a general alarm has been activated, what will you do?</label><br>
        <label><input type="radio" name="q5" value="Evacuate"> Please Evacuate to the nearest exit door</label><br>
        <label><input type="radio" name="q5" value="Ignore"> Ignore</label><br>
        <label><input type="radio" name="q5" value="Wait"> Wait inside the building</label><br>
        <label><input type="radio" name="q5" value="Call"> Call supervisor</label>
    </div>

    <div class="question-block">
        <label class="question">6. What is the primary purpose of emergency lighting in a facility?</label><br>
        <label><input type="radio" name="q6" value="Decoration"> Decoration</label><br>
        <label><input type="radio" name="q6" value="Visibility"> To ensure visibility during power outages</label><br>
        <label><input type="radio" name="q6" value="Heat"> Provide heat</label><br>
        <label><input type="radio" name="q6" value="Signal"> Create signals</label>
    </div>

    <div class="question-block">
        <label class="question">7. In the event of an emergency evacuation, where is the designated location you should proceed to?</label><br>
        <label><input type="radio" name="q7" value="Assembly"> Emergency Assembly Point</label><br>
        <label><input type="radio" name="q7" value="Office"> Back to office</label><br>
        <label><input type="radio" name="q7" value="Exit"> Stand near exit</label><br>
        <label><input type="radio" name="q7" value="Parking"> Parking area</label>
    </div>

    <div class="question-block">
        <label class="question">8. What color of trash bin should be used for disposing of paper towels and carton packaging?</label><br>
        <label><input type="radio" name="q8" value="Black"> Black</label><br>
        <label><input type="radio" name="q8" value="Green"> Green</label><br>
        <label><input type="radio" name="q8" value="Blue"> Blue</label><br>
        <label><input type="radio" name="q8" value="Red"> Red</label>
    </div>

    <div class="question-block">
        <label class="question">9. What color of trash bin should be used for disposing Food Waste and Organic waste?</label><br>
        <label><input type="radio" name="q9" value="Green"> Green</label><br>
        <label><input type="radio" name="q9" value="Black"> Black</label><br>
        <label><input type="radio" name="q9" value="Blue"> Blue</label><br>
        <label><input type="radio" name="q9" value="Yellow"> Yellow</label>
    </div>

    <div class="question-block">
        <label class="question">10. What color of trash bin should be used for disposing recyclable materials?</label><br>
        <label><input type="radio" name="q10" value="Blue"> Blue</label><br>
        <label><input type="radio" name="q10" value="Green"> Green</label><br>
        <label><input type="radio" name="q10" value="Black"> Black</label><br>
        <label><input type="radio" name="q10" value="Red"> Red</label>
    </div>

    <div class="question-block">
        <label class="question">Name of Trainee:</label><br>
        <input type="text" id="traineeName" placeholder="Juan Dela Cruz">
    </div>

    <button id="submitBtn" class="btn btn-primary">Submit</button>
    <button id="retakeBtn" class="btn btn-muted hidden">Retake Assessment</button>
</div>

<div id="result" class="card hidden"></div>

</div>

<script>
// ---- SAME FUNCTIONS (NO CHANGE EXCEPT LOGO + CERTIFICATE DESIGN) ----

const watchedChk=document.getElementById('watchedChk');
const startBtn=document.getElementById('startBtn');
const assessment=document.getElementById('assessment');
const resetBtn=document.getElementById('resetBtn');
const submitBtn=document.getElementById('submitBtn');
const retakeBtn=document.getElementById('retakeBtn');
const resultDiv=document.getElementById('result');
const trainingVideo=document.getElementById('trainingVideo');

const APP_SCRIPT_URL="https://script.google.com/macros/s/AKfycbyBql2dvKoJ0IuzXEXOAhsgABQy1_il_bFJrXPMB1EbMvqyOVvhLckFZaMRZAsx6TpZ/exec";
const SECRET="V9x!7Qm#4sP@2kT8zL$1gR";

let attemptCount=1;

trainingVideo.addEventListener('ended',()=>{ watchedChk.disabled=false; });
watchedChk.addEventListener('change',()=>{ startBtn.disabled=!watchedChk.checked; });

startBtn.addEventListener('click',()=>{
    assessment.classList.remove('hidden');
    resetBtn.classList.remove('hidden');
    resultDiv.classList.add('hidden');
});

resetBtn.addEventListener('click',resetAll);
retakeBtn.addEventListener('click',()=>{ attemptCount++; resetAll(); });

function resetAll(){
    for(let i=1;i<=10;i++){
        let c=document.querySelector(`input[name="q${i}"]:checked`);
        if(c) c.checked=false;
    }
    document.getElementById('traineeName').value="";
    resultDiv.innerHTML="";
    resultDiv.classList.add('hidden');
}

submitBtn.addEventListener('click',async()=>{
    let score=0;

    if(document.querySelector('input[name="q1"]:checked')?.value==="Smoke-free and Pet Friendly") score++;
    if(document.querySelector('input[name="q2"]:checked')?.value==="30KPH") score++;
    if(document.querySelector('input[name="q3"]:checked')?.value==="PASS") score++;
    if(document.querySelector('input[name="q4"]:checked')?.value==="All of the above") score++;
    if(document.querySelector('input[name="q5"]:checked')?.value==="Evacuate") score++;
    if(document.querySelector('input[name="q6"]:checked')?.value==="Visibility") score++;
    if(document.querySelector('input[name="q7"]:checked')?.value==="Assembly") score++;
    if(document.querySelector('input[name="q8"]:checked')?.value==="Black") score++;
    if(document.querySelector('input[name="q9"]:checked')?.value==="Green") score++;
    if(document.querySelector('input[name="q10"]:checked')?.value==="Blue") score++;

    let name=document.getElementById('traineeName').value.trim();
    if(!name) return alert("Pakilagay ang pangalan.");

    let result=(score===10)?"PASS":"FAIL";

    try{
        await fetch(APP_SCRIPT_URL,{
            method:"POST",
            mode:"no-cors",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify({
                token:SECRET, name:name, score:score,
                result:result, attempts:attemptCount
            })
        });
    }catch(e){}

    resultDiv.classList.remove('hidden');
    if(result==="PASS"){
        resultDiv.innerHTML="<h3 class='result-pass'>PASADO!</h3><p>Generating certificateâ€¦</p>";
        generateCertificate(name);
        retakeBtn.classList.add('hidden');
    } else {
        resultDiv.innerHTML="<h3 class='result-fail'>You FAILED.</h3><p>Try again.</p>";
        retakeBtn.classList.remove('hidden');
    }
});

// FINAL CERTIFICATE FUNCTION WITH LOGO + ORANGE DESIGN
async function generateCertificate(name){
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF({unit:"pt",format:"a4"});

    // ORANGE HEADER
    doc.setFillColor(255,140,0);
    doc.rect(0,0,595,80,'F');

    // ADD LOGO
    const img = new Image();
    img.src="https://raw.githubusercontent.com/Oswerex/ESH/6acfa4af336cce3696a01fea102eeaa626a67e01/ESHM%20Logo.png";
    img.onload=function(){
        doc.addImage(img,'PNG',250,10,90,60);

        // TITLE
        doc.setFontSize(28);
        doc.setTextColor(0,0,0);
        doc.text("Certificate of Completion",300,120,{align:"center"});

        // NAME
        doc.setFontSize(18);
        doc.text(`This Certifies that: ${name}`,300,200,{align:"center"});

        // COMPLETION TEXT
        doc.setFontSize(14);
        doc.text("Successfully completed the Safety Training Assessment",300,240,{align:"center"});

        doc.save(`Certificate_${name}.pdf`);
    }
}
</script>

</body>
</html>
